<div class="mt-4">
  <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />
  <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>

  <script>
    function goBack() {
      window.history.back();
    }
  </script>

  <div class="w-full py-4 shadow-md flex justify-between items-center px-4 bg-white">
    <h1 class="text-2xl font-bold mx-auto text-black"><%= @user.name %>'s Lists</h1>
  </div>

  <div class="flex justify-between items-center py-2 px-4 bg-white">
    <%= form_with url: lists_path, method: :get, local: true, class: "flex-1" do |form| %>
      <%= form.collection_select :list_id, @lists, :id, :title, { selected: @selected_list_id, prompt: 'Select a list' }, { onchange: 'this.form.submit()', class: 'border p-2 rounded' } %>
    <% end %>
  </div>

  <div class="flex justify-around py-2 bg-gray-100">
    <% if current_user == @user %>
      <%= button_to 'リスト削除', list_path(@selected_list_id), method: :delete, data: { confirm: 'Are you sure you want to delete this list?' }, class: 'text-white bg-red-500 p-2 rounded hover:bg-red-700' if @selected_list_id.present? %>
      <%= link_to 'リスト追加', new_list_path, class: 'text-white bg-green-500 p-2 rounded hover:bg-green-700' %>
    <% end %>
    <button onclick="goBack()" class="text-white bg-blue-500 p-2 rounded hover:bg-blue-700">戻る</button> <!-- 戻るボタンをif文の外に移動 -->
  </div>
  
  <style>
    .swiper-container {
      width: 350px;
      height: 700px;
    }
    .swiper-slide {
      width: 350px;
    }
  </style>

  <div class="swiper-container mx-auto mt-10 overflow-hidden">
    <div class="swiper-wrapper">
      <% @selected_list_cards.each do |card| %>
        <div class="swiper-slide relative bg-white shadow-2xl rounded-2xl border border-gray-300 p-4">
          <!-- Card content -->
          <div class="overflow-y-auto">
            <div class="flex flex-col items-center my-4">
              <img src="<%= card.book.image_url %>" alt="Book Cover" class="max-w-[200px] mb-4 rounded-lg shadow-md">
              <div class="text-left w-full">
                <% ['Book Name', 'Author', 'Publisher', 'Publication Date'].zip([card.book.title, card.book.author, card.book.publisher, card.book.published_date]).each do |label, value| %>
                  <div class="border-b border-black pb-1 mb-2">
                    <strong class="text-xl font-semibold text-black"><%= label %> :</strong> <%= value %>
                  </div>
                <% end %>
              </div>
            </div>
            <div class="mt-2 text-left w-full">
              <div class="border-b border-black pb-1 mb-2">
                <strong class="text-lg font-medium text-black">Favorite Point:</strong>
              </div>
              <p class="mt-2 text-gray-800 break-words"><%= card.text %></p>
            </div>
          </div>
        </div>
      <% end %>
    </div>
    <div class="swiper-pagination"></div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const container = document.querySelector('.swiper-container');
      if (container) {
        const swiper = new Swiper(container, {
          direction: 'horizontal',
          loop: true,
          effect: 'flip',
          slidesPerView: 1,
          pagination: {
            el: '.swiper-pagination',
            clickable: true,
          },
        });
      }
    });
  </script>
</div>
